@inject IHttpContextAccessor HttpContextAccessor
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery

<nav class="navbar-custom">
    <div class="container-custom flex-row justify-between items-center">
        <!-- Logo -->
        <a href="/" class="text-decoration-none flex-row items-center gap-3">
            <div class="nav-logo-box">
                <div class="nav-logo-glow"></div>
                <span class="text-white font-black">M</span>
            </div>
            <span class="text-xl font-black text-white text-uppercase italic tracking-widest">CineMaster</span>
        </a>

        <!-- Links -->
        <div class="hidden md-flex gap-5">
            <a href="/#movies-grid" class="text-decoration-none uppercase-nav hover-text-white transition-all"
               style="color: rgba(255,255,255,0.7);">Афіша</a>
            <a href="#" class="text-decoration-none uppercase-nav hover-text-white transition-all"
               style="color: rgba(255,255,255,0.7);">Кінотеатри</a>
            <a href="#" class="text-decoration-none uppercase-nav hover-text-white transition-all"
               style="color: rgba(255,255,255,0.7);">Новини</a>
        </div>

        <AuthorizeView>
            <Authorized>
                <div class="flex-row gap-3 items-center">
                    @if (context.User.IsInRole("Admin"))
                    {
                        <a href="/Admin/Dashboard" target="_top" class="btn-glass-hero text-decoration-none"
                           style="padding: 0.6rem 1rem; font-size: 0.85rem; border-radius: 2rem; display: inline-flex; align-items: center; gap: 0.5rem;"
                           title="Admin Panel">
                            <i class="bi bi-shield-lock" style="font-size: 1.1rem;"></i>
                        </a>
                    }
                    <a href="/Profile" target="_top" class="btn-glass-hero profile-btn text-decoration-none"
                       style="padding: 0.6rem 1.2rem; font-size: 0.85rem; border-radius: 2rem; display: inline-flex; align-items: center; gap: 0.5rem;"
                       title="@context.User.Identity?.Name">
                        <i class="bi bi-person-circle" style="font-size: 1.2rem;"></i>
                        <span style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">@context.User.Identity?.Name</span>
                    </a>
                    <form action="/Account/Logout" method="post" style="margin: 0;">
                        <input type="hidden" name="__RequestVerificationToken" value="@GetAntiforgeryToken()" />
                        <button type="submit" class="btn-glass-hero logout-btn"
                                style="padding: 0.6rem 1rem; font-size: 0.85rem; border-radius: 2rem; display: inline-flex; align-items: center; cursor: pointer; background: transparent; border: none;"
                                title="Вийти">
                            <i class="bi bi-box-arrow-right" style="font-size: 1.1rem;"></i>
                        </button>
                    </form>
                </div>
            </Authorized>
            <NotAuthorized>
                <a href="/Account/Login" target="_top" class="btn-glass-hero text-decoration-none"
                   style="padding: 0.6rem 1.5rem; font-size: 0.7rem; border-radius: 2rem;">
                    Увійти
                </a>
            </NotAuthorized>
        </AuthorizeView>
    </div>
</nav>

@code {
    private string GetAntiforgeryToken()
    {
        var httpContext = HttpContextAccessor.HttpContext;
        if (httpContext == null) return string.Empty;

        var tokens = Antiforgery.GetAndStoreTokens(httpContext);
        return tokens.RequestToken ?? string.Empty;
    }
}

